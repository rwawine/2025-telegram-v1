üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´
1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ callback_data (64 –±–∞–π—Ç–∞)
–ü—Ä–æ–±–ª–µ–º–∞: Telegram –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç callback_data –¥–æ 64 –±–∞–π—Ç, –Ω–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–µ—Ç
–†–∏—Å–∫: –ü–æ–ª–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ inline-–∫–Ω–æ–ø–æ–∫ —Å –æ—à–∏–±–∫–æ–π API
–ù–∞–π–¥–µ–Ω–æ –≤: bot/keyboards/main_menu.py, bot/smart_keyboards.py
2. –ù–µ–ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ callback handlers
–ü—Ä–æ–±–ª–µ–º–∞: –ï—Å—Ç—å inline –∫–Ω–æ–ø–∫–∏ –±–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
–†–∏—Å–∫: "callback query is too old" –æ—à–∏–±–∫–∏
–ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏:
edit_name, edit_phone, edit_card, edit_photo (keyboards/main_menu.py:54-59)
confirm_registration, cancel_registration (keyboards/main_menu.py:62-65)
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ info callbacks (info_rules, info_prizes, –∏ –¥—Ä.)
3. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≥–æ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ FSM
–ü—Ä–æ–±–ª–µ–º–∞: –í fallback_fixed.py —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ handlers –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–æ–≤
–†–∏—Å–∫: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
–ö–æ–¥: _register_quick_nav_handlers() –≤ —Å—Ç—Ä–æ–∫–µ 435
üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
4. Inconsistent File Size Validation
–ü—Ä–æ–±–ª–µ–º–∞: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –Ω–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞
–ú–µ—Å—Ç–∞: registration.py:237, support.py:222 - —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã
–†–∏—Å–∫: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
5. Missing Error Recovery in Database Operations
–ü—Ä–æ–±–ª–µ–º–∞: –í repositories.py –Ω–µ—Ç retry –ª–æ–≥–∏–∫–∏ –¥–ª—è –∑–∞–Ω—è—Ç–æ–π –ë–î
–†–∏—Å–∫: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
–ö–æ–¥: insert_participants_batch() - —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω rollback
6. Rate Limiting Too Lenient
–ü—Ä–æ–±–ª–µ–º–∞: 8 —Å–æ–±—ã—Ç–∏–π –∑–∞ 2.5 —Å–µ–∫—É–Ω–¥—ã = –æ—á–µ–Ω—å –º—è–≥–∫–æ –¥–ª—è —Å–ø–∞–º–∞
–†–∏—Å–∫: –£—Å–ø–µ—à–Ω—ã–µ DDoS –∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–æ–≤
–§–∞–π–ª: middleware/rate_limit.py:20
üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
7. Code Duplication in Handlers
–ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ü—Ä–∏–º–µ—Ä—ã:
get_participant_status() calls –≤ 5+ –º–µ—Å—Ç–∞—Ö
–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π error handling –≤ registration/support
8. Non-Centralized Message Templates
–ü—Ä–æ–±–ª–µ–º–∞: –°–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É –≤–º–µ—Å—Ç–æ messages.py
–†–∏—Å–∫: Inconsistent UX, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
–ü—Ä–∏–º–µ—Ä—ã: Hardcoded strings –≤ fallback handlers
9. Missing Input Sanitization
–ü—Ä–æ–±–ª–µ–º–∞: User input –Ω–µ sanitized –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
–†–∏—Å–∫: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ SQL injections –∏–ª–∏ XSS –≤ –∞–¥–º–∏–Ω–∫–µ
–§–∞–π–ª—ã: validators.py - —Ç–æ–ª—å–∫–æ format validation
üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
10. Improvement Opportunities
Context manager sessions –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã (–ø—Ä–æ–ø–∞–¥–∞—é—Ç –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ graceful shutdown –¥–ª—è worker threads
Logs –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã (–Ω–µ—Ç JSON format)
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ keyboards –º–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å