{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
</div>

<div class="row">
    <div class="col-lg-8">
        <form method="POST" action="{{ url_for('admin.save_settings') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="card">
                <div class="card-header">
                    <i class="fa-solid fa-gears me-2"></i>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">WEB_HOST</label>
                            <input type="text" class="form-control" name="WEB_HOST" value="{{ config.WEB_HOST }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">WEB_PORT</label>
                            <input type="number" class="form-control" name="WEB_PORT" value="{{ config.WEB_PORT }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">UPLOAD_FOLDER</label>
                            <input type="text" class="form-control" name="UPLOAD_FOLDER" value="{{ config.UPLOAD_FOLDER }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">EXPORT_FOLDER</label>
                            <input type="text" class="form-control" name="EXPORT_FOLDER" value="{{ config.EXPORT_FOLDER }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">LOG_FOLDER</label>
                            <input type="text" class="form-control" name="LOG_FOLDER" value="{{ config.LOG_FOLDER }}" disabled>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">MAX_PARTICIPANTS</label>
                            <input type="number" class="form-control" name="MAX_PARTICIPANTS" value="{{ config.MAX_PARTICIPANTS }}">
                        </div>
                    </div>
                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <a href="{{ url_for('admin.settings') }}" class="btn btn-outline ms-2">–û—Ç–º–µ–Ω–∞</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    <!-- –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ -->
    <div class="col-lg-8 mt-4">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <i class="fa-solid fa-triangle-exclamation me-2"></i>–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞
            </div>
            <div class="card-body">
                <h5 class="text-danger">‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h5>
                <p class="text-muted">–≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã –∏ —É–¥–∞–ª—è—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</p>
                
                <div class="d-grid gap-3 mt-3">
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#clearDatabaseModal">
                        <i class="fa-solid fa-database me-2"></i>
                        üóëÔ∏è –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                    </button>
                </div>
                
                <div class="alert alert-warning mt-3 mb-0">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –û—á–∏—Å—Ç–∫–∞ –ë–î —É–¥–∞–ª–∏—Ç:
                    <ul class="mb-0 mt-2">
                        <li>–í—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</li>
                        <li>–í—Å–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ –∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</li>
                        <li>–í—Å–µ —Ç–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏</li>
                        <li>–ò—Å—Ç–æ—Ä–∏—é —Ä–∞—Å—Å—ã–ª–æ–∫</li>
                        <li>–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –¥–∞–Ω–Ω—ã–µ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ë–î -->
<div class="modal fade" id="clearDatabaseModal" tabindex="-1" aria-labelledby="clearDatabaseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-danger">
            <form method="POST" action="{{ url_for('admin.clear_database') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="clearDatabaseModalLabel">
                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                        –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <h5 class="alert-heading">
                            <i class="fa-solid fa-skull-crossbones me-2"></i>
                            –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!
                        </h5>
                        <p><strong>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–Ω–∏—á—Ç–æ–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ:</strong></p>
                        <ul>
                            <li>üóëÔ∏è –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã</li>
                            <li>üé∞ –í—Å–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ –∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã</li>
                            <li>üí¨ –í—Å–µ —Ç–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã</li>
                            <li>üì® –í—Å—è –∏—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞</li>
                        </ul>
                        <p class="mb-0"><strong>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –ù–ï–í–û–ó–ú–û–ñ–ù–û!</strong></p>
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirmWordDatabase" class="form-label">
                            –î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ —Ñ—Ä–∞–∑—É: <strong class="text-danger">"–æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É"</strong>
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="confirmWordDatabase" 
                               name="confirm_word" 
                               required 
                               autocomplete="off"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ: –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É">
                        <div class="form-text text-danger">
                            ‚ö†Ô∏è –†–µ–≥–∏—Å—Ç—Ä –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è!
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark me-2"></i>–û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-danger" id="confirmClearDatabase" disabled>
                        <i class="fa-solid fa-trash-can me-2"></i>
                        –£–¥–∞–ª–∏—Ç—å –≤—Å—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –í–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏ –ë–î –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤–≤–æ–¥–µ
    const confirmInput = document.getElementById('confirmWordDatabase');
    const confirmButton = document.getElementById('confirmClearDatabase');
    
    if (confirmInput && confirmButton) {
        confirmInput.addEventListener('input', function() {
            const isValid = this.value.trim().toLowerCase() === '–æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É';
            confirmButton.disabled = !isValid;
            
            if (isValid) {
                confirmButton.classList.remove('btn-secondary');
                confirmButton.classList.add('btn-danger');
            } else {
                confirmButton.classList.remove('btn-danger');
                confirmButton.classList.add('btn-secondary');
            }
        });
        
        // –°–±—Ä–æ—Å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏
        document.getElementById('clearDatabaseModal').addEventListener('hidden.bs.modal', function() {
            confirmInput.value = '';
            confirmButton.disabled = true;
            confirmButton.classList.remove('btn-danger');
            confirmButton.classList.add('btn-secondary');
        });
    }
});
</script>
{% endblock %}

