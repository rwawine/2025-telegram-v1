{% extends "base.html" %}

{% block title %}–ú–æ–¥–µ—Ä–∞—Ü–∏—è{% endblock %}
{% block page_title %}–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫{% endblock %}
{% block page_subtitle %}–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="card-title mb-0">–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏</h2>
        <a class="btn btn-outline btn-sm" href="{{ url_for('admin.participants', status='pending') }}">–û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</a>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                        <th>–ö–æ–Ω—Ç–∞–∫—Ç—ã</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–§–æ—Ç–æ</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in participants %}
                    <tr>
                        <td>
                            <div style="font-weight: 600;">{{ p.full_name }}</div>
                            <div class="text-mono" style="font-size: 12px; color: var(--color-gray-500);">ID: {{ p.id }}</div>
                        </td>
                        <td class="small">{{ p.phone_number }}<br>@{{ p.username }}</td>
                        <td>{{ p.registration_date }}</td>
                        <td>
                            {% if p.photo_path %}
                            <a href="#" data-bs-toggle="modal" data-bs-target="#photoModal-{{ p.id }}" title="–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ">
                                <span class="status-badge status-approved" style="font-size: 11px;">–ï—Å—Ç—å</span>
                            </a>
                            {% else %}
                            <span class="status-badge status-archived" style="font-size: 11px;">–ù–µ—Ç</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group">
                                <a class="btn btn-sm btn-outline" href="{{ url_for('admin.participant_detail', participant_id=p.id) }}">üëÅÔ∏è</a>
                                <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#confirmationModal" data-bs-title="–û–¥–æ–±—Ä–∏—Ç—å?" data-bs-body="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏?" data-bs-action="{{ url_for('admin.update_single_participant_status', participant_id=p.id) }}" data-bs-fields='{"status":"approved"}'>‚úÖ</button>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#confirmationModal" data-bs-title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å?" data-bs-body='<div class="mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ—é:</div>
<div class="d-grid gap-2 mb-2">
<button type="button" class="btn btn-outline-secondary btn-sm" onclick="document.querySelector(`#confirmActionForm input[name=notes]`)?.setAttribute(`value`,`–ù–µ—á–µ—Ç–∫–æ–µ —Ñ–æ—Ç–æ –ª–∏—Ñ–ª–µ—Ç–∞.`)">üì∑ –ù–µ—á–µ—Ç–∫–æ–µ —Ñ–æ—Ç–æ</button>
<button type="button" class="btn btn-outline-secondary btn-sm" onclick="document.querySelector(`#confirmActionForm input[name=notes]`)?.setAttribute(`value`,`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.`)">üìù –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
<button type="button" class="btn btn-outline-secondary btn-sm" onclick="document.querySelector(`#confirmActionForm input[name=notes]`)?.setAttribute(`value`,`–ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.`)">üí≥ –ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</button>
<button type="button" class="btn btn-outline-secondary btn-sm" onclick="document.querySelector(`#confirmActionForm input[name=notes]`)?.setAttribute(`value`,`–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª.`)">‚ö†Ô∏è –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª</button>
</div>
<input type="text" class="form-control" placeholder="–°–≤–æ—è –ø—Ä–∏—á–∏–Ω–∞" oninput="document.querySelector(`#confirmActionForm input[name=notes]`)?.setAttribute(`value`, this.value)">' data-bs-action="{{ url_for('admin.update_single_participant_status', participant_id=p.id) }}" data-bs-fields='{"status":"rejected","notes":""}'>‚ùå</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% for p in participants %}
<div class="modal fade" id="photoModal-{{ p.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–§–æ—Ç–æ: {{ p.full_name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img src="{{ url_for('admin.serve_upload', filename=p.photo_path.split('/')[-1] if p.photo_path else '') }}" class="img-fluid rounded" alt="–§–æ—Ç–æ">
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(){
    // no-op, modal wiring is global in base
});
</script>
{% endblock %}


